# LastWar 프로젝트 개발 워크플로우 규칙

Task Master 규칙을 Claude Code에 통합하여 자동으로 적용되는 개발 가이드라인입니다.

## 프로젝트 구조 및 작업 방식

### 디렉토리 구조
```
/lastwar/                        # 프로젝트 루트 (Claude 실행 위치)
├── CLAUDE.md                   # 이 파일 - 통합 개발 규칙
├── .taskmaster/                # Task Master 설정
├── lastwar-api/                # 백엔드 프로젝트 (Spring Boot)
└── lastwar-www/                # 프론트엔드 프로젝트 (Next.js)
```

### 작업 위치 규칙
- **루트 레벨 (`/lastwar/`)**: 
  - Claude Code 실행 위치
  - Task Master 관련 작업
  - Claude 설정 및 워크플로우 관리
  - **Git 관리 안함** (taskmaster, claude 관련 파일 제외)
  
- **백엔드 작업 (`/lastwar-api/`)**:
  - 모든 Spring Boot 관련 개발
  - Java/Kotlin 코드 작성
  - 데이터베이스 마이그레이션
  - **Git 관리**: 백엔드 코드 변경사항

- **프론트엔드 작업 (`/lastwar-www/`)**:
  - 모든 Next.js 관련 개발  
  - TypeScript/React 코드 작성
  - UI/UX 구현
  - **Git 관리**: 프론트엔드 코드 변경사항

### 작업 플로우
1. **계획 단계**: `/lastwar/`에서 Task Master로 작업 계획
2. **백엔드 구현**: `/lastwar-api/`로 이동하여 개발 및 커밋
3. **프론트엔드 구현**: `/lastwar-www/`로 이동하여 개발 및 커밋
4. **통합 관리**: `/lastwar/`에서 전체 프로젝트 상태 확인

## 프로젝트 아키텍처

### 백엔드: lastwar-api (Spring Boot)
- **데이터베이스**: PostgreSQL with 멀티테넌트 격리
- **아키텍처**: JPA/QueryDSL, REST API, JWT 인증
- **보안**: 모든 쿼리에 `server_alliance_id` 필터링 필수

### 프론트엔드: lastwar-www (Next.js)
- **기술 스택**: Next.js 14+ App Router, TypeScript, Tailwind CSS, ShadCN UI
- **테스트**: MCP Puppeteer for E2E 테스트
- **아키텍처**: React Server Components, 반응형 디자인

## 백엔드 개발 워크플로우 (lastwar-api)

### 1. 멀티테넌트 데이터 격리 (필수)
모든 백엔드 작업 시 다음을 반드시 확인하세요:
- [ ] 모든 쿼리에 `server_alliance_id` 필터링 확인
- [ ] 교차 테넌트 데이터 접근 방지 테스트 작성
- [ ] 데이터 격리 검증 테스트 실행
- [ ] JWT에서 추출한 `getCurrentServerAllianceId()` 사용

### 2. 데이터베이스 설계
- [ ] JPA 어노테이션으로 엔터티 관계 설계
- [ ] 감사 필드 포함 (created_at, updated_at, created_by)
- [ ] PostgreSQL 인덱스 최적화 고려
- [ ] 모든 테이블에 `server_alliance_id` 컬럼 포함

### 3. 레포지토리 계층
- [ ] 복잡한 연산을 위한 QueryDSL 쿼리 구현
- [ ] `findByIdAndServerAllianceId()` 패턴 사용
- [ ] 모든 쿼리에 멀티테넌트 필터링 보장
- [ ] 페시미스틱 락 메서드에도 테넌트 격리 적용

### 4. 서비스 계층 구현
- [ ] 적절한 검증을 포함한 비즈니스 로직 구현
- [ ] 트랜잭션 관리 추가 (@Transactional)
- [ ] `JwtAuthUtils.getCurrentServerAllianceId()` 사용
- [ ] 에러 처리 및 커스텀 예외 포함

### 5. 컨트롤러 계층
- [ ] 프로젝트 규칙을 따르는 REST 엔드포인트 생성
- [ ] 적절한 요청/응답 DTO 추가
- [ ] API 문서화를 위한 Swagger 어노테이션 포함

### 6. 보안 및 검증
- [ ] JWT 토큰 및 사용자 권한 검증
- [ ] Bean Validation을 사용한 입력 검증 추가
- [ ] 권한 체크 구현

### 7. 테스트 요구사항
- [ ] 서비스 계층 단위 테스트 (최소 80% 커버리지)
- [ ] API 엔드포인트 통합 테스트
- [ ] 멀티테넌트 격리 테스트 (필수)
- [ ] 복잡한 쿼리에 대한 성능 테스트

## 프론트엔드 개발 워크플로우 (lastwar-www)

### 1. TypeScript 타입 안전성 (필수)
- [ ] types/ 디렉토리에 적절한 TypeScript 인터페이스 정의
- [ ] 모든 API 응답에 대한 엄격한 타입 체킹
- [ ] 적절한 에러 타입 정의 추가
- [ ] props 및 state 타입 검증

### 2. 컴포넌트 아키텍처
- [ ] 적절한 Next.js App Router 패턴 사용
- [ ] 클라이언트/서버 컴포넌트 분리 구현
- [ ] ShadCN UI 컴포넌트 패턴 준수
- [ ] 반응형 디자인 보장 (모바일 우선)

### 3. API 통합
- [ ] 기존 api-service.ts 패턴을 사용한 API 호출 구현
- [ ] 적절한 에러 처리 및 로딩 상태 추가
- [ ] 적절한 인증 토큰 처리 보장
- [ ] 응답 데이터 타입 검증

### 4. 상태 관리
- [ ] React 훅 (useState, useContext) 적절히 사용
- [ ] 적절한 데이터 페칭 패턴 구현
- [ ] 적절한 곳에 낙관적 업데이트 추가
- [ ] 인증 상태 적절히 처리

### 5. MCP Puppeteer 테스트
- [ ] 주요 사용자 플로우에 대한 E2E 테스트 시나리오 생성
- [ ] 다양한 뷰포트에서 반응형 디자인 테스트
- [ ] 폼 제출 및 데이터 표시 검증
- [ ] 인증 플로우 테스트

## 풀스택 개발 워크플로우

### Phase 1: 백엔드 우선 개발
1. **데이터베이스 설계**: 멀티테넌트 격리를 고려한 스키마 설계
2. **엔터티 및 레포지토리**: QueryDSL과 테넌트 필터링
3. **서비스 계층**: 비즈니스 로직과 보안 검증
4. **REST API**: 표준화된 엔드포인트와 문서화
5. **백엔드 테스트**: 단위 테스트와 통합 테스트

### Phase 2: 프론트엔드 통합
1. **타입 정의**: API 응답에 대한 TypeScript 인터페이스
2. **API 서비스**: 백엔드와의 통신 계층
3. **컴포넌트 개발**: ShadCN UI 패턴 준수
4. **상태 관리**: React 훅과 데이터 플로우
5. **E2E 테스트**: MCP Puppeteer로 사용자 플로우 검증

### Phase 3: 통합 및 품질 보증
1. **풀스택 통합 테스트**: 엔드투엔드 데이터 플로우
2. **성능 최적화**: 백엔드 쿼리와 프론트엔드 번들 최적화
3. **보안 검증**: 멀티테넌트 격리 엔드투엔드 검증
4. **문서화**: API 문서와 사용자 가이드

## Git 워크플로우 규칙

### 브랜치 전략
- **main**: 운영 브랜치 (프로덕션 배포)
- **feature/기능명**: 새로운 기능 개발
- **fix/수정명**: 기존 기능 수정 및 버그 수정

### 작업 시작 전 필수 단계
- [ ] **브랜치 상태 확인**: `git status`, `git branch -a` 실행
- [ ] **main 브랜치 최신화**: `git checkout main && git pull origin main`
- [ ] **적절한 브랜치 생성**:
  - 새 기능: `git checkout -b feature/기능명`
  - 수정 작업: `git checkout -b fix/수정명`
- [ ] **브랜치 생성 확인**: `git branch`로 현재 브랜치 확인

### 개발 진행 중 커밋 규칙
- [ ] **의미있는 단위로 커밋 분할**
- [ ] **한글 커밋 메시지 작성**:
  ```bash
  git commit -m "사용자 목록 API 엔드포인트 구현
  
  - User 엔터티에 server_alliance_id 필터링 추가
  - 페이징 및 정렬 기능 포함
  - 멀티테넌트 데이터 격리 검증 완료"
  ```
- [ ] **정기적 중간 푸시**: `git push origin 브랜치명`

### 작업 완료 후 필수 단계
- [ ] **최종 테스트 실행 및 통과 확인**
- [ ] **코드 정리 및 불필요한 파일 제거**
- [ ] **최종 커밋 및 푸시**
- [ ] **Pull Request 생성 및 상세 내용 작성**
- [ ] **코드 리뷰 및 승인 대기**
- [ ] **main 브랜치 머지 완료**

## 품질 게이트

### 백엔드 품질 게이트
- [ ] 멀티테넌트 데이터 격리 검증 완료
- [ ] 모든 쿼리가 server_alliance_id 필터링 사용
- [ ] 테스트 커버리지 80% 이상
- [ ] API 문서 업데이트 완료
- [ ] 성능 벤치마크 통과
- [ ] 보안 검증 완료

### 프론트엔드 품질 게이트
- [ ] TypeScript strict 모드 준수
- [ ] 모든 API 응답 적절히 타입화
- [ ] 반응형 디자인 테스트 완료 (모바일/태블릿/데스크톱)
- [ ] 접근성 표준 충족 (WCAG 2.1 AA)
- [ ] MCP Puppeteer E2E 테스트 통과
- [ ] 성능 벤치마크 유지

### 풀스택 품질 게이트
- [ ] 멀티테넌트 데이터 격리 엔드투엔드 검증
- [ ] 완전한 데이터 플로우 테스트 통과
- [ ] 보안 검증 완료 (인증, 권한, 데이터 격리)
- [ ] 성능 최적화 완료
- [ ] 문서화 업데이트 완료

## 중요 참고사항

### 작업 위치 준수 (필수)
- **루트 레벨 (`/lastwar/`)**: Task Master, Claude 설정만. 코드 변경 시 Git 관리 안함
- **백엔드 코드**: 반드시 `/lastwar-api/` 디렉토리로 이동하여 작업
- **프론트엔드 코드**: 반드시 `/lastwar-www/` 디렉토리로 이동하여 작업
- **Git 커밋**: 각 프로젝트 디렉토리에서만 수행

### 멀티테넌트 보안
- **필수**: 모든 데이터베이스 쿼리에 `server_alliance_id` 필터링
- **필수**: JWT에서 추출한 테넌트 ID만 사용
- **필수**: 교차 테넌트 접근 방지 테스트

### 개발 우선순위
1. **보안**: 멀티테넌트 격리 최우선
2. **안정성**: 테스트 커버리지와 에러 처리
3. **성능**: 쿼리 최적화와 번들 크기
4. **사용자 경험**: 반응형 디자인과 접근성

### Claude Code 사용 팁
- **작업 위치 엄수**: 백엔드는 `/lastwar-api/`, 프론트엔드는 `/lastwar-www/`에서만 코딩
- **루트 레벨 용도**: Task Master 계획 수립과 전체 프로젝트 관리만
- 멀티테넌트 격리는 모든 작업에서 자동 확인
- Git 워크플로우 규칙을 자동으로 적용
- 한글 커밋 메시지와 PR 템플릿 사용
- 각 프로젝트에서 개별적으로 Git 관리

---

_이 가이드는 Claude Code가 LastWar 프로젝트의 개발 워크플로우를 자동으로 적용하기 위한 통합 규칙입니다._